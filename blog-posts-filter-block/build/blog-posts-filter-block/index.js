(()=>{"use strict";var e={n:s=>{var t=s&&s.__esModule?()=>s.default:()=>s;return e.d(t,{a:t}),t},d:(s,t)=>{for(var a in t)e.o(t,a)&&!e.o(s,a)&&Object.defineProperty(s,a,{enumerable:!0,get:t[a]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.blocks,t=JSON.parse('{"UU":"bpffb/blog-posts-filter"}'),a=window.wp.blockEditor,n=window.wp.components,r=window.wp.element,l=window.wp.apiFetch;var i=e.n(l);const c=window.wp.htmlEntities,o=window.ReactJSXRuntime,d=(document?.documentElement?.lang||"en").split("-")[0],m=({perPage:e,page:s,cat:t})=>{const a=new URLSearchParams;return a.set("per_page",String(e)),a.set("page",String(s)),a.set("_embed","1"),a.set("orderby","date"),a.set("order","desc"),t&&Number(t)>0&&a.set("categories",String(t)),d&&a.set("lang",d),`/wp/v2/posts?${a.toString()}`};function p({perPage:e=6,columns:s=3}){const[t,a]=(0,r.useState)([]),[l,p]=(0,r.useState)(0),[u,h]=(0,r.useState)(!0),[g,x]=(0,r.useState)(1),[j,f]=(0,r.useState)([]),[b,v]=(0,r.useState)(1),[w,y]=(0,r.useState)(!0),[N,k]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=!1;return h(!0),i()({path:`/wp/v2/categories?per_page=100&hide_empty=1&lang=${d}`}).then(s=>{if(e)return;const t=Array.isArray(s)?s:[];a(t.filter(e=>Number(e?.count||0)>0))}).catch(s=>{e||k(s?.message||"Failed to load categories")}).finally(()=>{e||h(!1)}),()=>{e=!0}},[]),(0,r.useEffect)(()=>{let s=!1;return y(!0),k(""),i()({path:m({perPage:e,page:g,cat:l}),parse:!1}).then(async e=>{const t=await e.json(),a=Number(e.headers.get("X-WP-TotalPages")||"1");s||(f(Array.isArray(t)?t:[]),v(a||1))}).catch(e=>{s||k(e?.message||"Failed to load posts")}).finally(()=>{s||y(!1)}),()=>{s=!0}},[e,g,l]);const S=(0,r.useMemo)(()=>({display:"grid",gridTemplateColumns:`repeat(${s}, minmax(0, 1fr))`,gap:"1.5rem"}),[s]),P=(0,r.useMemo)(()=>Array.from({length:b},(e,s)=>s+1),[b]),_=e=>{p(e),x(1)};return(0,o.jsxs)("div",{className:"hide-wp-block-classes alignwide mb-3",children:[u?(0,o.jsx)(n.Spinner,{}):t.length>0?(0,o.jsxs)("ul",{className:"nav nav-pills blog-filters mb-3",children:[(0,o.jsx)("li",{className:"nav-item",children:(0,o.jsx)("a",{className:"nav-link "+(0===l?"active":""),onClick:()=>_(0),children:"View all"})}),t.map(e=>(0,o.jsx)("li",{className:"nav-item",children:(0,o.jsx)("a",{className:"nav-link "+(l===e.id?"active":""),onClick:()=>_(e.id),children:(0,c.decodeEntities)(e.name)})},e.id))]}):null,N&&(0,o.jsx)("div",{className:"bpffb-error alert alert-danger",children:N}),w?(0,o.jsx)(n.Spinner,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:S,children:j.map(e=>{const s=(e=>{const s=e?._embedded?.["wp:featuredmedia"]?.[0];return{url:s?.source_url||"",alt:s?.alt_text||""}})(e),t=(a=e,(a?._embedded?.["wp:term"]?.[0]||[]).map(e=>({id:e.id,name:e.name,link:e.link})));var a;const n=((e="",s=200)=>{const t=e.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),a=t?t.split(" ").length:0;return`${Math.max(1,Math.round(a/s))} min`})(e?.content?.rendered||"");return(0,o.jsxs)("article",{className:"h-100 d-flex flex-column position-relative border-0",children:[s.url&&(0,o.jsx)("img",{className:"mb-3 rounded",src:s.url,alt:s.alt,style:{width:"100%",aspectRatio:"4/3",objectFit:"cover"},loading:"lazy"}),(0,o.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2 flex-wrap",children:[t.map(e=>(0,o.jsx)("a",{href:e.link,className:"badge bg-primary-subtle border border-primary-subtle text-primary-emphasis text-decoration-none border border-primary",children:(0,c.decodeEntities)(e.name)},e.id)),(0,o.jsxs)("span",{className:"small text-muted",children:[n," read"]})]}),(0,o.jsx)("h3",{className:"h5 mb-2",dangerouslySetInnerHTML:{__html:e.title.rendered}}),(0,o.jsxs)("div",{className:"flex-grow-1 d-flex flex-column justify-content-between",children:[(0,o.jsx)("div",{className:"mb-0 text-muted",dangerouslySetInnerHTML:{__html:e.excerpt.rendered}}),(0,o.jsxs)("a",{className:"stretched-link icon-link",href:e.link,children:["Read more",(0,o.jsx)("svg",{class:"icon",children:(0,o.jsx)("use",{href:"/wp-content/themes/kp-theme/assets/fonts/icon.svg#chevron-right"})})]})]})]},e.id)})}),b>1&&(0,o.jsxs)("div",{className:"pagination justify-content-center mt-4 d-flex gap-2 align-items-center",children:[g>1&&(0,o.jsxs)("a",{className:"prev-next icon-link",onClick:()=>x(e=>Math.max(1,e-1)),children:["Previous",(0,o.jsx)("svg",{class:"icon",children:(0,o.jsx)("use",{href:"/wp-content/themes/kp-theme/assets/fonts/icon.svg#chevron-left"})})]}),(0,o.jsx)("div",{className:"d-flex gap-1",children:P.map(e=>(0,o.jsx)("a",{className:"page-numbers "+(e===g?"current":""),onClick:()=>x(e),"aria-current":e===g?"page":void 0,children:e},e))}),g<b&&(0,o.jsxs)("a",{className:"prev-next icon-link",onClick:()=>x(e=>Math.min(b,e+1)),children:["Next",(0,o.jsx)("svg",{class:"icon",children:(0,o.jsx)("use",{href:"/wp-content/themes/kp-theme/assets/fonts/icon.svg#chevron-right"})})]})]})]})]})}(0,s.registerBlockType)(t.UU,{edit:function({attributes:e,setAttributes:s}){const{perPage:t,columns:r}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.InspectorControls,{children:(0,o.jsxs)(n.PanelBody,{title:"Settings",initialOpen:!0,children:[(0,o.jsx)(n.RangeControl,{label:"Posts per page",value:t,min:1,max:24,onChange:e=>s({perPage:e})}),(0,o.jsx)(n.RangeControl,{label:"Columns",value:r,min:1,max:4,onChange:e=>s({columns:e})})]})}),(0,o.jsx)(p,{perPage:t,columns:r})]})},save:()=>null})})();