(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,n=JSON.parse('{"UU":"bpffb/blog-posts-filter"}'),a=window.wp.blockEditor,s=window.wp.components,l=window.wp.element,r=window.wp.apiFetch;var i=e.n(r);const o=window.ReactJSXRuntime,c=({perPage:e,page:t,cat:n})=>{const a=new URLSearchParams;return a.set("per_page",String(e)),a.set("page",String(t)),a.set("_embed","1"),a.set("orderby","date"),a.set("order","desc"),n&&Number(n)>0&&a.set("categories",String(n)),`/wp/v2/posts?${a.toString()}`};function d({perPage:e=6,columns:t=3}){const[n,a]=(0,l.useState)([]),[r,d]=(0,l.useState)(0),[m,p]=(0,l.useState)(!0),[u,x]=(0,l.useState)(1),[g,h]=(0,l.useState)([]),[b,j]=(0,l.useState)(1),[f,v]=(0,l.useState)(!0),[w,y]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=!1;return p(!0),i()({path:"/wp/v2/categories?per_page=100&hide_empty=1"}).then(t=>{if(e)return;const n=Array.isArray(t)?t:[];a(n.filter(e=>Number(e?.count||0)>0))}).catch(t=>{e||y(t?.message||"Failed to load categories")}).finally(()=>{e||p(!1)}),()=>{e=!0}},[]),(0,l.useEffect)(()=>{let t=!1;return v(!0),y(""),i()({path:c({perPage:e,page:u,cat:r}),parse:!1}).then(async e=>{const n=await e.json(),a=Number(e.headers.get("X-WP-TotalPages")||"1");t||(h(Array.isArray(n)?n:[]),j(a||1))}).catch(e=>{t||y(e?.message||"Failed to load posts")}).finally(()=>{t||v(!1)}),()=>{t=!0}},[e,u,r]);const N=(0,l.useMemo)(()=>({display:"grid",gridTemplateColumns:`repeat(${t}, minmax(0, 1fr))`,gap:"1.5rem"}),[t]),S=(0,l.useMemo)(()=>Array.from({length:b},(e,t)=>t+1),[b]),k=e=>{d(e),x(1)};return(0,o.jsxs)("div",{className:"hide-wp-block-classes alignwide mb-3",children:[m?(0,o.jsx)(s.Spinner,{}):n.length>0?(0,o.jsxs)("ul",{className:"nav nav-pills blog-filters mb-3",children:[(0,o.jsx)("li",{className:"nav-item",children:(0,o.jsx)("button",{type:"button",className:"nav-link "+(0===r?"active":""),onClick:()=>k(0),children:"View all"})}),n.map(e=>(0,o.jsx)("li",{className:"nav-item",children:(0,o.jsx)("button",{type:"button",className:"nav-link "+(r===e.id?"active":""),onClick:()=>k(e.id),children:e.name})},e.id))]}):null,w&&(0,o.jsx)("div",{className:"bpffb-error alert alert-danger",children:w}),f?(0,o.jsx)(s.Spinner,{}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{style:N,children:g.map(e=>{const t=(e=>{const t=e?._embedded?.["wp:featuredmedia"]?.[0];return{url:t?.source_url||"",alt:t?.alt_text||""}})(e),n=(a=e,(a?._embedded?.["wp:term"]?.[0]||[]).map(e=>({id:e.id,name:e.name,link:e.link})));var a;const s=((e="",t=200)=>{const n=e.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim(),a=(n?n.split(" ").length:0)/t,s=Math.max(1,Math.floor(a)),l=Math.max(s,Math.ceil(a));return s===l?`${s} min`:`${s}–${l} min`})(e?.content?.rendered||"");return(0,o.jsxs)("article",{className:"h-100 d-flex flex-column position-relative border-0",children:[t.url&&(0,o.jsx)("img",{className:"mb-3 rounded",src:t.url,alt:t.alt,style:{width:"100%",aspectRatio:"4/3",objectFit:"cover"},loading:"lazy"}),(0,o.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2 flex-wrap",children:[n.map(e=>(0,o.jsx)("a",{href:e.link,className:"badge rounded-pill text-bg-light text-decoration-none",children:e.name},e.id)),(0,o.jsx)("span",{className:"small text-muted",children:s}),(0,o.jsx)("p",{className:"mb-0 small text-muted",children:"Read"})]}),(0,o.jsx)("h3",{className:"h5 mb-2",dangerouslySetInnerHTML:{__html:e.title.rendered}}),(0,o.jsxs)("div",{className:"flex-grow-1 d-flex flex-column justify-content-between",children:[(0,o.jsx)("div",{className:"mb-0 text-muted",dangerouslySetInnerHTML:{__html:e.excerpt.rendered}}),(0,o.jsxs)("a",{className:"stretched-link icon-link mt-2 text-decoration-none",href:e.link,children:["Read more"," ",(0,o.jsx)("span",{"aria-hidden":"true",style:{fontSize:18,lineHeight:1},children:"›"})]})]})]},e.id)})}),b>1&&(0,o.jsxs)("div",{className:"pagination justify-content-center mt-4 d-flex gap-2 align-items-center",children:[(0,o.jsx)("button",{type:"button",className:"btn btn-link prev-next text-decoration-none",onClick:()=>x(e=>Math.max(1,e-1)),disabled:u<=1,children:"Previous"}),(0,o.jsx)("div",{className:"d-flex gap-1",children:S.map(e=>(0,o.jsx)("button",{type:"button",className:"btn btn-link text-decoration-none "+(e===u?"fw-bold":""),onClick:()=>x(e),"aria-current":e===u?"page":void 0,children:e},e))}),(0,o.jsx)("button",{type:"button",className:"btn btn-link prev-next text-decoration-none",onClick:()=>x(e=>Math.min(b,e+1)),disabled:u>=b,children:"Next"})]})]})]})}(0,t.registerBlockType)(n.UU,{edit:function({attributes:e,setAttributes:t}){const{perPage:n,columns:l}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.InspectorControls,{children:(0,o.jsxs)(s.PanelBody,{title:"Settings",initialOpen:!0,children:[(0,o.jsx)(s.RangeControl,{label:"Posts per page",value:n,min:1,max:24,onChange:e=>t({perPage:e})}),(0,o.jsx)(s.RangeControl,{label:"Columns",value:l,min:1,max:4,onChange:e=>t({columns:e})})]})}),(0,o.jsx)(d,{perPage:n,columns:l})]})},save:()=>null})})();